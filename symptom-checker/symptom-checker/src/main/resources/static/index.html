<script>
    // Detect environment and set API base
    const API_BASE = window.location.hostname === 'localhost' 
        ? 'http://localhost:8080/api'
        : 'https://java-miniproject.onrender.com/api';

    // --- Utility ---
    function el(id){ return document.getElementById(id); }
    function show(id){ el(id).style.display = ''; }
    function hide(id){ el(id).style.display = 'none'; }

    // --- Auth state ---
    function setUser(username){
      if(username){
        localStorage.setItem('sc_user', username);
        el('usernameBadge').textContent = username;
        show('userSection'); hide('authButtons'); hide('loginSection'); hide('registerSection'); hide('landing');
        show('dashboard');
        loadAllDiseases();
      } else {
        localStorage.removeItem('sc_user');
        hide('userSection'); show('authButtons'); show('landing'); hide('dashboard');
      }
    }
    function getUser(){ return localStorage.getItem('sc_user'); }

    // Init UI
    (function init(){
      const u = getUser();
      if(u) setUser(u);
      else { hide('dashboard'); show('landing'); }
    })();

    // Buttons
    el('showLoginBtn').onclick = () => { show('loginSection'); hide('registerSection'); hide('landing'); }
    el('showRegisterBtn').onclick = () => { show('registerSection'); hide('loginSection'); hide('landing'); }
    el('goToLogin').onclick = () => { show('loginSection'); hide('registerSection'); hide('landing'); }
    el('goToRegister').onclick = () => { show('registerSection'); hide('loginSection'); hide('landing'); }

    el('cancelLogin').onclick = () => { hide('loginSection'); show('landing'); el('loginMsg').textContent=''; }
    el('cancelReg').onclick = () => { hide('registerSection'); show('landing'); el('regMsg').textContent=''; }
    el('logoutBtn').onclick = () => { setUser(null); }

    // Register
    el('regSubmit').onclick = async () => {
      const username = el('regUser').value.trim();
      const password = el('regPass').value;
      el('regMsg').textContent = '';
      if(!username || !password){ el('regMsg').innerHTML = '<div class="msg error">Enter username and password</div>'; return; }
      try {
        const res = await fetch(`${API_BASE}/users/register`, {
          method:'POST',
          headers:{'Content-Type':'application/json'},
          body: JSON.stringify({ username, password })
        });
        const txt = await res.text();
        if(res.ok){ el('regMsg').innerHTML = '<div class="msg ok">'+txt+'</div>'; setTimeout(()=>{ hide('registerSection'); show('loginSection'); },800); }
        else el('regMsg').innerHTML = '<div class="msg error">'+txt+'</div>';
      } catch(err){
        el('regMsg').innerHTML = '<div class="msg error">Network error</div>';
      }
    };

    // Login
    el('loginSubmit').onclick = async () => {
      const username = el('loginUser').value.trim();
      const password = el('loginPass').value;
      el('loginMsg').textContent = '';
      if(!username || !password){ el('loginMsg').innerHTML = '<div class="msg error">Enter username and password</div>'; return; }
      try {
        const res = await fetch(`${API_BASE}/users/login`, {
          method:'POST',
          headers:{'Content-Type':'application/json'},
          body: JSON.stringify({ username, password })
        });
        const txt = await res.text();
        if(res.ok) { el('loginMsg').innerHTML = '<div class="msg ok">'+txt+'</div>'; setUser(username); }
        else el('loginMsg').innerHTML = '<div class="msg error">'+txt+'</div>';
      } catch(err){
        el('loginMsg').innerHTML = '<div class="msg error">Network error</div>';
      }
    };

    // Quick search (landing)
    el('quickSearchBtn').onclick = () => {
      const q = el('quickSearchInput').value.trim();
      if(!q) { el('quickResults').innerHTML = '<div class="msg error">Enter symptoms</div>'; return; }
      doSearch(q, 'quickResults');
    };
    el('viewAllBtn').onclick = () => { // show list tab
      if(!getUser()) { alert('View all requires login â€” login or register first.'); return; }
      selectTab('listTab');
    };

    // Tabs
    document.querySelectorAll('.tab').forEach(t=>{
      t.addEventListener('click', ()=> selectTab(t.dataset.tab));
    });
    function selectTab(tab){
      document.querySelectorAll('.tab').forEach(t=> t.classList.toggle('active', t.dataset.tab===tab));
      document.querySelectorAll('.tabContent').forEach(c=> c.style.display = c.id===tab ? '' : 'none');
      if(tab==='listTab') loadAllDiseases();
    }

    // Search, Add Disease, Load All, and Helpers remain unchanged...
</script>
